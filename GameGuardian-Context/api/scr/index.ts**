import express from 'express';
import { SessionService, SessionRequest } from './session.service';

const app = express();
const port = 3000;
const sessionService = new SessionService();

app.use(express.json());

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', service: 'GameGuardian API' });
});

// Iniciar sesi贸n supervisada
app.post('/api/sessions/start', async (req, res) => {
  try {
    const request: SessionRequest = req.body;
    
    // Validaciones b谩sicas
    if (!request.adultId || !request.childId) {
      return res.status(400).json({ error: 'adultId y childId son requeridos' });
    }

    const session = await sessionService.startSupervisedSession(request);
    
    res.status(201).json({
      success: true,
      sessionId: session.id,
      message: 'Sesi贸n creada. Esperando autorizaci贸n de padres.',
      nextSteps: [
        'Los padres recibieron notificaci贸n',
        'El ni帽o debe aceptar la invitaci贸n',
        'La sesi贸n comenzar谩 cuando ambos autoricen'
      ]
    });
  } catch (error: any) {
    res.status(500).json({ 
      success: false, 
      error: error.message 
    });
  }
});

// Obtener estado de sesi贸n
app.get('/api/sessions/:sessionId', (req, res) => {
  // Implementar
  res.json({ message: 'Endpoint en desarrollo' });
});

// Finalizar sesi贸n
app.post('/api/sessions/:sessionId/end', (req, res) => {
  // Implementar
  res.json({ message: 'Endpoint en desarrollo' });
});

// Dashboard para padres - obtener sesiones de un ni帽o
app.get('/api/parent/children/:childId/sessions', (req, res) => {
  // Implementar
  res.json({ message: 'Endpoint en desarrollo' });
});

app.listen(port, () => {
  console.log(` GameGuardian API ejecut谩ndose en http://localhost:${port}`);
  console.log(` Health check: http://localhost:${port}/health`);
});
